<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Chat</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="/css/main.css">
</head>
<body>
<div class="chat-container container">
    <div class="row form-group">
        <div class="col-xs-12 col-md-offset-2 col-md-8 col-lg-8 col-lg-offset-2">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <span class="glyphicon glyphicon-comment"></span> Chat

                    <div class="btn-group pull-right">
                        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </button>
                        <ul class="dropdown-menu slidedown">
                            <li><a href="#"><span class="glyphicon glyphicon-refresh">
                            </span>Refresh</a></li>
                        </ul>
                    </div>
                </div>
                <div class="panel-body body-panel">
                    <ul class="chat" id="chat">
                        <li class="left clearfix">
                            <div class="chat-body clearfix">
                                <div class="header">
                                    <strong class="primary-font">Jack Sparrow</strong> 
                                </div>
                                <p class="pull-left">
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare
                                    dolor, quis ullamcorper ligula sodales.
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="panel-footer clearfix">
                    <form id="chat-form">
                        <input type="hidden" name="name" id="name" value="Anonymous"/>
                        <textarea class="form-control" rows="3" placeholder="Enter your message" name="message" id="message"></textarea>
                        <span class="text-muted">Status: <span id="status">Idle</span></span>
                        <button type="submit" class="btn btn-success pull-right" id="send-btn">Send</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.2/socket.io.js"></script>
	<script>
		$(function(){
			var socket = io.connect();

            //Status
            socket.on('status', function(data){
                $('#status').text(data);
            });

            socket.on('messages', function(data){
                if(data.length){
                    for(var i = 0 ; i < data.length ; ++i){
                        var list = $(document.createElement('li'));
                        list.addClass('left clearfix');

                        var header = $(document.createElement('div'));
                        header.addClass('header');

                        var name = $(document.createElement('strong'));
                        name.addClass('primary-font');
                        name.text(data[i].name);

                        var message = $(document.createElement('p'));
                        message.addClass('pull-left');
                        message.text(data[i].message);

                        header.append(name);
                        list.append(header);
                        list.append(message);

                        $('#chat').append(list);
                    }
                }
            });

            //Send message
            function sendMessage(){
                socket.emit('input', {
                    name: $('#name').val(),
                    message: $('#message').val()
                });

                $('#message').val('');
            }

            $('#message').keypress(function(event) {
                if(event.which == 13 && event.shiftKey === false){
                    event.preventDefault();

                    sendMessage();
                }
            });

            $('#chat-form').submit(function(event){
                event.preventDefault();

                sendMessage();
            })
		});
	</script>
</body>
</html>